<!DOCTYPE html>
<html>
<head>
  <title>Nuxt 3 Learning Game - Quiz Editor</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f4f5f7;
      color: #2c3e50;
      line-height: 1.6;
      padding: 20px;
    }
    #app {
      max-width: 1000px;
      margin: 0 auto;
      background-color: #ffffff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    h1, h2 {
      color: #00dc82;
      text-align: center;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input[type="text"], textarea, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      font-size: 16px;
    }
    textarea {
      height: 100px;
    }
    .options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .option {
      display: flex;
      align-items: center;
    }
    .option input[type="radio"] {
      margin-right: 10px;
    }
    .button {
      display: inline-block;
      padding: 12px 24px;
      background-color: #00dc82;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s ease;
    }
    .btn-danger {
      background: #ef4444;
    }
    .button:hover {
      background-color: #00b86b;
    }
    .btn-danger:hover {
      background-color: #b32a2a;
    }
    .action-buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 30px auto;
    }
    .question-list {
      margin-top: 30px;
    }
    .question-item {
      background-color: #f0f4f8;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    .question-item h3 {
      margin-top: 0;
    }
    .actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 10px;
    }
    .edit-btn, .delete-btn {
      padding: 5px 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    .edit-btn {
      background-color: #3b82f6;
      color: white;
    }
    .delete-btn {
      background-color: #ef4444;
      color: white;
    }
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
    .nav-link {
      text-decoration: none;
      color: #00dc82;
      font-weight: bold;
    }
    .stats {
      background-color: #e0f2fe;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
    }
    .ai-assist {
      background-color: #fdf2f8;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .ai-assist h2 {
      color: #db2777;
    }
    .ai-assist textarea {
      height: 100px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div id="app">
    <h1>Quiz Editor</h1>
    
    <div class="stats">
      <h2>Select Quiz</h2>
      <select id="quiz-dropdown" @change="selectQuiz">
        <option v-for="(quiz, index) in quizzes" :key="index" :value="index"> {{ quiz.name }} </option>
      </select>

      <div class="action-buttons">
        <button @click="createNewQuiz('')" class="button">Create New Quiz</button>
        <button @click="deleteQuiz" class="button btn-danger">Delete Quiz</button>
      </div>

      <form @submit.prevent="editQuiz">
        <div class="form-group">
          <label for="quiz-name">Edit Quiz Name:</Label>
          <input type="text" id="quiz-name" v-model="quizzes[currentQuiz].name" required>
        </div>
        <div class="form-group">
          <label for="quiz-description">Edit Quiz Description:</label>
          <textarea id="quiz-description" v-model="quizzes[currentQuiz].description"></textarea>
        </div>
        <div class="form-group">
          <label for="quiz-congratulations">Edit Quiz Congratulation Message:</label>
          <input type="text" id="quiz-congratulations" v-model="quizzes[currentQuiz].congratulations"></input>
        </div>
        <div class="form-group">
          <label for="quiz-failed">Edit Quiz Failed Message:</label>
          <input type="text" id="quiz-failed" v-model="quizzes[currentQuiz].failed"></input>
        </div>
        <div class="action-buttons">
          <button type="submit" class="button">Save Quiz</button>
        </div>
      </form>
    </div>

    <div class="stats">
      <h2>Quiz Statistics</h2>
      <p>Total Questions: {{ quizzes[currentQuiz].questions.length }}</p>
      <p>Categories: {{ uniqueCategories.join(', ') }}</p>
      <p>Average Difficulty: {{ averageDifficulty.toFixed(1) }} / 5</p>
    </div>

    <div class="quiz-editor">
      <h2>{{ isEditing ? 'Edit Question' : 'Add New Question' }}</h2>
      <form @submit.prevent="saveQuestion">
        <div class="form-group">
          <label for="question">Question:</label>
          <textarea id="question" v-model="currentQuestion.question" required></textarea>
        </div>
        <div class="form-group">
          <label>Options:</label>
          <div class="options">
            <div v-for="(option, index) in currentQuestion.options" :key="index">
              <div v-if="index < 2" class="option">
                <input type="radio" :id="'option' + index" :value="index" v-model="currentQuestion.correctAnswer" required>
                <input type="text" v-model="currentQuestion.options[index]" required>
              </div>
              <div v-else class="option">
                <input type="radio" :id="'option' + index" :value="index" v-model="currentQuestion.correctAnswer">
                <input type="text" v-model="currentQuestion.options[index]">
              </div>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="explanation">Explanation:</label>
          <textarea id="explanation" v-model="currentQuestion.explanation" required></textarea>
        </div>
        <div class="form-group">
          <label for="category">Category:</label>
          <input type="text" id="category" v-model="currentQuestion.category" required>
        </div>
        <div class="form-group">
          <label for="difficulty">Difficulty (1-5):</label>
          <input type="number" id="difficulty" v-model="currentQuestion.difficulty" min="1" max="5" required>
        </div>
        <button type="submit" class="button">{{ isEditing ? 'Update Question' : 'Add Question' }}</button>
        <button type="button" @click="resetForm" class="button" style="margin-left: 10px;">{{ isEditing ? 'Cancel' : 'Clear' }}</button>
      </form>
    </div>

    <div v-if="quizzes[currentQuiz].questions.length > 0" class="question-list">
      <h2>Question List</h2>
      <div v-for="(question, index) in quizzes[currentQuiz].questions" :key="index" class="question-item">
        <h3>Question {{ index + 1 }}</h3>
        <p><strong>Category:</strong> {{ question.category }}</p>
        <p><strong>Difficulty:</strong> {{ question.difficulty }}/5</p>
        <p>{{ question.question }}</p>
        <div class="actions">
          <button @click="editQuestion(index)" class="edit-btn">Edit</button>
          <button @click="deleteQuestion(index)" class="delete-btn">Delete</button>
        </div>
      </div>
    </div>

    <div class="nav-buttons">
      <a href="take-a-quiz.html" class="nav-link">Take a Quiz</a>
      <a href="view-all-quizzes.html" class="nav-link">View All Quizzes</a>
    </div>
  </div>

  <script>
    const { createApp, ref, reactive, computed, onMounted } = Vue;

    createApp({
      setup() {
        const quizzes = ref([
          {
            name: "Nuxt 3 Basics",
            description: "Test your knowledge of the basics of Nuxt 3.",
            congratulations: "Congratulations! You have successfully completed the Nuxt 3 Basics quiz.",
            failed: "You have failed the Nuxt 3 Basics quiz. Please try again.",
            questions: [
              {
                question: "What is the purpose of the 'pages' directory in Nuxt 3?",
                options: [
                  "To store static assets",
                  "To define API routes",
                  "To create file-based routing",
                  "To store global components"
                ],
                correctAnswer: 2,
                explanation: "In Nuxt 3, the 'pages' directory is used for file-based routing. Each Vue file in this directory automatically becomes a route in your application.",
                category: "Routing",
                difficulty: 2
              }
            ]
          }
        ]);
        const currentQuiz = ref(0);
        const currentQuestion = reactive({
          question: '',
          options: ['', '', '', ''],
          correctAnswer: null,
          explanation: '',
          category: '',
          difficulty: 3
        });
        const isEditing = ref(false);
        let editingIndex = -1;

        const uniqueCategories = computed(() => {
          return [...new Set(quizzes.value[currentQuiz.value].questions.map(q => q.category))];
        });

        const averageDifficulty = computed(() => {
          if (quizzes.value[currentQuiz.value].questions.length === 0) return 0;
          const sum = quizzes.value[currentQuiz.value].questions.reduce((acc, q) => acc + q.difficulty, 0);
          return sum / quizzes.value[currentQuiz.value].questions.length;
        });

        onMounted(() => {
          const savedQuizzes = localStorage.getItem('nuxt3Quizzes');
          if (savedQuizzes) {
            quizzes.value = JSON.parse(savedQuizzes);
          }
        });

        function selectQuiz() {
          currentQuiz.value = document.getElementById('quiz-dropdown').value;
        }

        function createNewQuiz(textPrompt) {
          textPrompt = textPrompt || 'Digite o nome do novo quiz:';
          let quizName = prompt(textPrompt);
          if (quizName) {
            quizzes.value.push({
              name: quizName,
              questions: []
            });    
            saveToLocalStorage();
            alert("Quiz criado com sucesso!");
          }
        }

        function editQuiz() {
          let name = document.getElementById('quiz-name').value;
          let description = document.getElementById('quiz-description').value;
          let congratulations = document.getElementById('quiz-congratulations').value;
          let failed = document.getElementById('quiz-failed').value;
          quizzes.value[currentQuiz.value].name = name;
          quizzes.value[currentQuiz.value].description = description;
          quizzes.value[currentQuiz.value].congratulations = congratulations;
          quizzes.value[currentQuiz.value].failed = failed;
          alert("Quiz salvo com sucesso!");
          saveToLocalStorage();
        }

        function deleteQuiz() {
          if (confirm('Tem certeza que quer deletar o quiz (' + quizzes.value[currentQuiz.value].name + ')?')) {
            quizzes.value.splice(currentQuiz.value, 1);
            currentQuiz.value = 0;
            if (quizzes.value.length === 0) {
              createNewQuiz('Você precisa ter pelo menos um quiz salvo, por favor digite o nome do novo quiz:');
            } else {
              saveToLocalStorage();
              alert(`Quiz ${quizzes.value[currentQuiz.value].name} deletado com sucesso.`);
            }
          }
        }

        function saveQuestion() {
          const newQuestion = { ...currentQuestion };
          console.log(quizzes);
          if (isEditing.value) {
            quizzes.value[currentQuiz.value].questions[editingIndex] = newQuestion;
            isEditing.value = false;
            editingIndex = -1;
          } else {
            quizzes.value[currentQuiz.value].questions.push(newQuestion);
          }
          resetForm();
          saveToLocalStorage();
        }

        function resetForm() {
          Object.assign(currentQuestion, {
            question: '',
            options: ['', '', '', ''],
            correctAnswer: null,
            explanation: '',
            category: '',
            difficulty: 3
          });
          isEditing.value = false;
          editingIndex = -1;
        }

        function editQuestion(index) {
          Object.assign(currentQuestion, quizzes.value[currentQuiz.value].questions[index]);
          isEditing.value = true;
          editingIndex = index;
        }

        function deleteQuestion(index) {
          if (confirm('Tem certeza que quer deletar essa questão?')) {
            quizzes.value[currentQuiz.value].questions.splice(index, 1);
            saveToLocalStorage();
          }
        }

        function saveToLocalStorage() {
          localStorage.setItem('nuxt3Quizzes', JSON.stringify(quizzes.value));
        }

        return {
          quizzes,
          currentQuiz,
          currentQuestion,
          isEditing,
          uniqueCategories,
          averageDifficulty,
          aiPrompt,
          selectQuiz,
          createNewQuiz,
          editQuiz,
          deleteQuiz,
          saveQuestion,
          resetForm,
          editQuestion,
          deleteQuestion,
        };
      }
    }).mount('#app');
  </script>
</body></html>